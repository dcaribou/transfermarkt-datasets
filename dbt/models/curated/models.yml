version: 2

models:
  - name: appearances
    tests:
      - dbt_expectations.expect_table_columns_to_contain_set:
          column_list:
            - appearance_id
            - game_id
            - player_id
            - player_club_id
            - player_current_club_id
            - date
            - player_name
            - competition_id
            - yellow_cards
            - red_cards
            - goals
            - assists
            - minutes_played
    columns:
      - name: appearance_id
        tests:
          - unique

  - name: clubs
    tests:
      - dbt_expectations.expect_table_columns_to_contain_set:
          column_list:
            - club_id
            - club_code # TODO: many nulls
            - name # TODO: many nulls
            - domestic_competition_id
            - total_market_value # TODO: many nulls
            - squad_size
            - average_age
            - foreigners_number
            - foreigners_percentage
            - national_team_players
            - stadium_name
            - stadium_seats
            - net_transfer_record
            - coach_name # TODO: many nulls
            - url
            - club_id
    columns:
      - name: club_code
        tests:
          - unique
          - not_null
      - name: name
        tests:
          - not_null

  - name: competitions
    tests:
      - dbt_expectations.expect_table_columns_to_contain_set:
          column_list:
            - competition_id
            - competition_code
            - name # TODO: many nulls
            - type
            - sub_type
            - country_id
            - country_name
            # - country_latitude
            # - country_longitude
            - domestic_league_code
            - confederation
            - url
    columns:
      - name: competition_id
        tests:
          - unique

  - name: players
    tests:
      - dbt_expectations.expect_table_columns_to_contain_set:
          column_list:
            - player_id
            - name
            - current_club_id
            - current_club_name
            - country_of_citizenship
            - country_of_birth
            - city_of_birth
            - date_of_birth
            - position
            - sub_position
            - foot
            - height_in_cm
            # - market_value_in_eur
            # - highest_market_value_in_eur
            - agent_name
            # - contract_expiration_date
            - current_club_domestic_competition_id
            - first_name
            - last_name
            - player_code
            - image_url
            - last_season
            - url
    columns:
      - name: player_id
        tests:
          - unique
          - not_null
      - name: player_code
        tests:
          - unique
          - not_null
      - name: name
        tests:
          - not_null
      - name: current_club_name
        tests:
          - not_null

  - name: player_valuations
    tests:
      - dbt_expectations.expect_table_columns_to_contain_set:
          column_list:
            - player_id
            - date
            - datetime
            - dateweek
            - current_club_id
            - market_value_in_eur
            - player_club_domestic_competition_id
      - unique:
          column_name: (player_id || "date")
    columns:
      - name: player_id
        tests:
          - not_null
      - name: market_value_in_eur
        description: >
          The player's market value for the given date in EUR.
        tests:
          - not_null

  - name: games
    tests:
      - dbt_expectations.expect_table_columns_to_contain_set:
          column_list:
            - game_id
            - competition_id
            - game_id
            - competition_id
            - competition_type
            - season
            - round
            - date
            - home_club_id
            - away_club_id
            - home_club_goals
            - away_club_goals
            # - aggregate
            - home_club_position
            - away_club_position
            # - club_home_name
            # - club_away_name
            - home_club_manager_name
            - away_club_manager_name
            - stadium
            - attendance
            - referee
            - url
    columns:
      - name: game_id
        tests:
          - unique
          - not_null

  - name: club_games
    tests:
      - dbt_expectations.expect_table_columns_to_contain_set:
          column_list:
            - club_id
            - game_id
            - own_goals
            - own_position
            - own_manager_name
            - opponent_id
            - opponent_goals
            - opponent_position
            - opponent_manager_name
            - hosting
            - is_win
    tests:
      - unique:
          column_name: (game_id || club_id)

  - name: game_events
    tests:
      - dbt_expectations.expect_table_columns_to_contain_set:
          column_list:
            - game_id
            - minute
            - type
            - club_id
            - player_id
            - description
            - player_in_id
